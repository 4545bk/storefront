{"version":3,"sources":["../src/edgeResponseTransform.js"],"names":["edgeResponseTransform","env","behindOuterEdge","removeSMaxAge","cacheControl","headers","header","replace"],"mappings":";;;;;;;AAAA;;;;;AAKA;;;AAGe,SAASA,qBAAT,GAAiC;AAC9C,MAAIC,GAAG,CAACC,eAAJ,KAAwB,OAA5B,EAAqC;AAAE;AACrCC,IAAAA,aAAa;AACd;AACF;AAED;;;;;;AAIA,SAASA,aAAT,GAAyB;AACvB,MAAIC,YAAY,GAAGC,OAAO,CAACC,MAAR,CAAe,eAAf,CAAnB;;AAEA,MAAIF,YAAY,IAAI,IAApB,EAA0B;AACxBA,IAAAA,YAAY,GAAGA,YAAY,CAACG,OAAb,CAAqB,0BAArB,EAAiD,EAAjD,CAAf;AACAF,IAAAA,OAAO,CAACC,MAAR,CAAe,eAAf,EAAgCF,YAAhC;AACD;AACF","sourcesContent":["/**\n * @license\n * Copyright Â© 2017-2018 Moov Corporation.  All rights reserved.\n */\n\n/**\n * Helper for moov_edge_response_transform.js\n */\nexport default function edgeResponseTransform() {\n  if (env.behindOuterEdge === 'false') { // this is set in requestHeaderTransform.js\n    removeSMaxAge()\n  } \n}\n\n/**\n * Remove the s-maxage response header so it won't be used by any upstream optimizer or CDN, \n * which could lead to stale data in a cache that wouldn't automatically be cleared on deploy.\n */\nfunction removeSMaxAge() {\n  let cacheControl = headers.header('Cache-Control')\n\n  if (cacheControl != null) {\n    cacheControl = cacheControl.replace(/(,\\s*)?s-maxage=[^\\s]+$/i, '')\n    headers.header('Cache-Control', cacheControl)\n  }\n}\n"],"file":"edgeResponseTransform.js"}