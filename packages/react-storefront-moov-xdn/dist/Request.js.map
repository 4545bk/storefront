{"version":3,"sources":["../src/Request.js"],"names":["Request","env","path","split","search","Object","assign","sendResponse","global","headers","Headers","JSON","parse","query","qs","method","port","host","secure","hostname","host_no_port","protocol","body","parseBody","console","warn","request","contentType","get","toLowerCase","requestBody","e","Error","message","startsWith"],"mappings":";;;;;;;AAIA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;AAEA;;;;IAIqBA,O;;;AAEnB,qBAAc;AAAA;;AAAA,0BACWC,GAAG,CAACC,IAAJ,CAASC,KAAT,CAAe,IAAf,CADX;AAAA;AAAA,QACLD,IADK;AAAA,QACCE,MADD;;AAGZC,IAAAA,MAAM,CAACC,MAAP,CAAc,IAAd,EAAoB;AAClBC,MAAAA,YAAY,EAAEC,MAAM,CAACD,YADH;AAElBE,MAAAA,OAAO,EAAE,IAAIC,gBAAJ,CAAYT,GAAG,CAACQ,OAAJ,GAAcE,IAAI,CAACC,KAAL,CAAWX,GAAG,CAACQ,OAAf,CAAd,GAAwC,0BAApD,CAFS;AAGlBP,MAAAA,IAAI,EAAJA,IAHkB;AAIlBE,MAAAA,MAAM,EAAEA,MAAM,cAAOA,MAAP,IAAkB,EAJd;AAKlBS,MAAAA,KAAK,EAAEC,YAAGF,KAAH,CAASR,MAAT,CALW;AAMlBW,MAAAA,MAAM,EAAEd,GAAG,CAACc,MANM;AAOlBC,MAAAA,IAAI,EAAEf,GAAG,CAACgB,IAAJ,CAASd,KAAT,CAAe,GAAf,EAAoB,CAApB,MAA2BF,GAAG,CAACiB,MAAJ,GAAa,KAAb,GAAqB,IAAhD,CAPY;AAQlBC,MAAAA,QAAQ,EAAElB,GAAG,CAACmB,YARI;AASlBC,MAAAA,QAAQ,EAAEpB,GAAG,CAACmB,YAAJ,KAAqB,WAArB,GAAmC,OAAnC,GAA6CnB,GAAG,CAACiB,MAAJ,GAAa,QAAb,GAAwB;AAT7D,KAApB;AAYA,SAAKI,IAAL,GAAYC,SAAS,CAAC,IAAD,CAArB;AACD;;;;wBAEc;AACbC,MAAAA,OAAO,CAACC,IAAR,CAAa,8GAAb;AACA,aAAO,KAAKvB,IAAZ;AACD;;;;;AAIH;;;;;;;;;;;AAOA,SAASqB,SAAT,CAAmBG,OAAnB,EAA4B;AAC1B,MAAMC,WAAW,GAAG,CAACD,OAAO,CAACjB,OAAR,CAAgBmB,GAAhB,CAAoB,cAApB,KAAuC,EAAxC,EAA4CC,WAA5C,EAApB;AACA,MAAMP,IAAI,GAAGd,MAAM,CAACsB,WAApB;;AAEA,MAAIH,WAAW,KAAK,kBAApB,EAAwC;AACtC,QAAI;AACF,aAAOhB,IAAI,CAACC,KAAL,CAAWU,IAAX,CAAP;AACD,KAFD,CAEE,OAAOS,CAAP,EAAU;AACV,YAAM,IAAIC,KAAJ,CAAU,uDAAuDD,CAAC,CAACE,OAAnE,CAAN;AACD;AACF,GAND,MAMO,IAAIN,WAAW,KAAK,mCAApB,EAAyD;AAC9D,WAAOb,YAAGF,KAAH,CAASU,IAAT,CAAP;AACD,GAFM,MAEA,IAAIK,WAAW,CAACO,UAAZ,CAAuB,qBAAvB,CAAJ,EAAmD;AACxD,QAAI;AACF,aAAO,oCAAsBZ,IAAtB,EAA4BK,WAA5B,CAAP;AACD,KAFD,CAEE,OAAOI,CAAP,EAAU;AACV,YAAM,IAAIC,KAAJ,CAAU,0DAA0DD,CAAC,CAACE,OAAtE,CAAN;AACD;AACF;AACF","sourcesContent":["/**\n * @license\n * Copyright Â© 2017-2018 Moov Corporation.  All rights reserved.\n */\nimport getHeaders from \"./getHeaders\"\nimport qs from 'qs'\nimport parseMultipartRequest from './parseMultipartRequest'\nimport Headers from './Headers'\n\n/**\n * Creates a request object for route handlers from the moovjs environment.\n * @return {Object}\n */\nexport default class Request {\n  \n  constructor() {\n    const [path, search] = env.path.split(/\\?/)\n\n    Object.assign(this, {\n      sendResponse: global.sendResponse, \n      headers: new Headers(env.headers ? JSON.parse(env.headers) : getHeaders()), \n      path, \n      search: search ? `?${search}` : '',\n      query: qs.parse(search),\n      method: env.method, \n      port: env.host.split(/:/)[1] || (env.secure ? '443' : '80'),\n      hostname: env.host_no_port,\n      protocol: env.host_no_port === 'localhost' ? 'http:' : env.secure ? 'https:' : 'http:'\n    })\n\n    this.body = parseBody(this)\n  }\n\n  get pathname() {\n    console.warn('warning: request.pathname is deprecated and will be removed in a future version of react-storefront-moov-xdn')\n    return this.path\n  }\n\n}\n\n/**\n * Parses JSON and form body content\n * @private\n * @param {String} body The request body\n * @param {String} contentType The content-type header\n * @return {Object}\n */\nfunction parseBody(request) {\n  const contentType = (request.headers.get('content-type') || '').toLowerCase()\n  const body = global.requestBody\n\n  if (contentType === 'application/json') {\n    try {\n      return JSON.parse(body)\n    } catch (e) {\n      throw new Error('could not parse request body as application/json: ' + e.message)\n    }\n  } else if (contentType === 'application/x-www-form-urlencoded') {\n    return qs.parse(body)\n  } else if (contentType.startsWith('multipart/form-data')) {\n    try {\n      return parseMultipartRequest(body, contentType)\n    } catch (e) {\n      throw new Error('could not parse request body as multipart/form-data: ' + e.message)\n    }\n  }\n}\n"],"file":"Request.js"}