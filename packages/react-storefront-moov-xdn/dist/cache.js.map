{"version":3,"sources":["../src/cache.js"],"names":["cache","serverMaxAge","browserMaxAge","cacheControl","push","headers","removeAllHeaders","header","length","join","cacheProxiedAssets","pathname","match","FAR_FUTURE","ONE_DAY"],"mappings":";;;;;;;;;AAAA;;;;;AAKA;;;;;;AAMO,SAASA,KAAT,OAAgD;AAAA,MAA/BC,YAA+B,QAA/BA,YAA+B;AAAA,MAAjBC,aAAiB,QAAjBA,aAAiB;AACrD,MAAMC,YAAY,GAAG,EAArB;;AAEA,MAAID,aAAa,KAAK,CAAtB,EAAyB;AACvBC,IAAAA,YAAY,CAACC,IAAb;AACD,GAFD,MAEO,IAAIF,aAAa,IAAI,IAArB,EAA2B;AAChCC,IAAAA,YAAY,CAACC,IAAb,kBAA4BF,aAA5B;AACD;;AAED,MAAID,YAAJ,EAAkB;AAChB;AACAI,IAAAA,OAAO,CAACC,gBAAR,CAAyB,KAAzB;AACAD,IAAAA,OAAO,CAACC,gBAAR,CAAyB,KAAzB;AACAD,IAAAA,OAAO,CAACC,gBAAR,CAAyB,SAAzB;AACAD,IAAAA,OAAO,CAACE,MAAR,CAAe,cAAf,EAA+B,MAA/B;AACAJ,IAAAA,YAAY,CAACC,IAAb,oBAA8BH,YAA9B;AACD;;AAED,MAAIE,YAAY,CAACK,MAAjB,EAAyB;AACvBH,IAAAA,OAAO,CAACE,MAAR,CAAe,eAAf,EAAgCJ,YAAY,CAACM,IAAb,CAAkB,IAAlB,CAAhC;AACD;AACF;AAED;;;;;;AAIO,SAASC,kBAAT,CAA4BC,QAA5B,SAAwD;AAAA,MAAhBV,YAAgB,SAAhBA,YAAgB;;AAC7D,MAAIU,QAAQ,CAACC,KAAT,CAAe,wCAAf,CAAJ,EAA8D;AAC5DZ,IAAAA,KAAK,CAAC;AAAEC,MAAAA,YAAY,EAAZA;AAAF,KAAD,CAAL;AACD;AACF;AAED;;;;;AAGO,IAAMY,UAAU,GAAG,SAAnB;AAEP;;;;;AAGO,IAAMC,OAAO,GAAG,KAAhB","sourcesContent":["/**\n * @license\n * Copyright Â© 2017-2018 Moov Corporation.  All rights reserved.\n */\n\n/**\n * Sets the correct response headers to configure browser and server caching\n * @param {Object} options\n * @param {Number} options.serverMaxAge The TTL for the edge caches.  Set to 0 to send a no-cache.  Omit to send no value for the client.\n * @param {Number} options.browserMaxAge The TTL for the browser's cache\n */\nexport function cache({ serverMaxAge, browserMaxAge }) {\n  const cacheControl = []\n\n  if (browserMaxAge === 0) {\n    cacheControl.push(`no-cache`)\n  } else if (browserMaxAge != null) {\n    cacheControl.push(`maxage=${browserMaxAge}`)\n  }\n\n  if (serverMaxAge) {\n    // remove these headers so varnish caching works correctly\n    headers.removeAllHeaders(\"Age\")\n    headers.removeAllHeaders(\"Via\")\n    headers.removeAllHeaders(\"Expires\")\n    headers.header('X-Moov-Cache', 'true')\n    cacheControl.push(`s-maxage=${serverMaxAge}`)\n  }\n\n  if (cacheControl.length) {\n    headers.header('Cache-Control', cacheControl.join(', '))\n  }\n}\n\n/**\n * Sets a cache time of one day for all image and font assets which are proxied from upstream.\n * @param {String} pathname \n */\nexport function cacheProxiedAssets(pathname, { serverMaxAge }) {\n  if (pathname.match(/(jpeg|jpg|png|gif|svg|woff2?|ttf|otf)$/)) {\n    cache({ serverMaxAge })\n  }\n}\n\n/**\n * The TTL for far-future cached assets\n */\nexport const FAR_FUTURE = 290304000\n\n/**\n * The number of seconds in a day\n */\nexport const ONE_DAY = 86400"],"file":"cache.js"}