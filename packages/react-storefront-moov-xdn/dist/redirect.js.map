{"version":3,"sources":["../src/redirect.js"],"names":["isAmpPost","env","referer","split","endsWith","method","toLowerCase","redirectTo","url","statusCode","protocol","match","host","headers","addHeader","removeAllHeaders","serverMaxAge","browserMaxAge","redirectToHttps","path"],"mappings":";;;;;;;;AAIA;;AAJA;;;;;AAMA;;;;AAIA,SAASA,SAAT,GAAqB;AAAA,aACCC,GADD;AAAA,MACXC,OADW,QACXA,OADW;AAGnB,SACEA,OAAO,IACPA,OAAO,CAACC,KAAR,CAAc,GAAd,EAAmB,CAAnB,EAAsBC,QAAtB,CAA+B,MAA/B,CADA,IAEAH,GAAG,CAACI,MAAJ,CAAWC,WAAX,OAA6B,MAH/B;AAKD;AAED;;;;;;;AAKO,SAASC,UAAT,CAAoBC,GAApB,EAAyC;AAAA,MAAhBC,UAAgB,uEAAL,GAAK;AAC9C,MAAMC,QAAQ,GAAIT,GAAG,CAACC,OAAJ,IAAeD,GAAG,CAACC,OAAJ,CAAYC,KAAZ,CAAkB,GAAlB,EAAuB,CAAvB,CAAhB,IAA8C,OAA/D;;AAEA,MAAI,CAACK,GAAG,CAACG,KAAJ,CAAU,aAAV,CAAL,EAA+B;AAC7BH,IAAAA,GAAG,aAAME,QAAN,gBAAoBT,GAAG,CAACW,IAAxB,SAA+BJ,GAA/B,CAAH;AACD;;AAED,MAAIR,SAAS,EAAb,EAAiB;AACfa,IAAAA,OAAO,CAACC,SAAR,CAAkB,iBAAlB,EAAqCN,GAArC;AACAK,IAAAA,OAAO,CAACC,SAAR,CAAkB,+BAAlB,EAAmD,wDAAnD;AACAD,IAAAA,OAAO,CAACC,SAAR,CAAkB,wCAAlB,YAA+DJ,QAA/D,gBAA6ET,GAAG,CAACW,IAAjF;AACD,GAJD,MAIO;AACLC,IAAAA,OAAO,CAACE,gBAAR,CAAyB,UAAzB;AACAF,IAAAA,OAAO,CAACC,SAAR,CAAkB,UAAlB,EAA8BN,GAA9B;AACAK,IAAAA,OAAO,CAACJ,UAAR,GAAqBA,UAArB;AACD;;AAED,oBAAM;AAAEO,IAAAA,YAAY,EAAE,CAAhB;AAAmBC,IAAAA,aAAa,EAAE;AAAlC,GAAN;AACD;AAED;;;;;AAGO,SAASC,eAAT,GAA2B;AAChCX,EAAAA,UAAU,mBAAYN,GAAG,CAACW,IAAhB,SAAuBX,GAAG,CAACkB,IAA3B,EAAV;AACD","sourcesContent":["/**\n * @license\n * Copyright Â© 2017-2018 Moov Corporation.  All rights reserved.\n */\nimport { cache } from './cache'\n\n/**\n * Returns true if the request is a post from an amp page, otherwise false\n * @return {Boolean}\n */\nfunction isAmpPost() {\n  const { referer } = env\n\n  return (\n    referer && \n    referer.split('?')[0].endsWith('.amp') &&\n    env.method.toLowerCase() === 'post'\n  )\n}\n\n/**\n * Sends an http redirect.\n * @param {String} url The destination url.  Can be relative or absolute.\n * @param {Number} statusCode The status code to send.  Defaults to 301\n */\nexport function redirectTo(url, statusCode=301) {\n  const protocol = (env.referer && env.referer.split(/:/)[0]) || 'https'\n\n  if (!url.match(/https?:\\/\\//)) {\n    url = `${protocol}://${env.host}${url}`\n  }\n\n  if (isAmpPost()) {\n    headers.addHeader(\"amp-redirect-to\", url)\n    headers.addHeader(\"access-control-expose-headers\", \"AMP-Access-Control-Allow-Source-Origin,AMP-Redirect-To\")\n    headers.addHeader(\"amp-access-control-allow-source-origin\", `${protocol}://${env.host}`)\n  } else {\n    headers.removeAllHeaders(\"Location\")\n    headers.addHeader(\"Location\", url)\n    headers.statusCode = statusCode\n  }\n\n  cache({ serverMaxAge: 0, browserMaxAge: 0 })\n}\n\n/**\n * Redirects the browser to the same URL but on https.\n */\nexport function redirectToHttps() {\n  redirectTo(`https://${env.host}${env.path}`)\n}"],"file":"redirect.js"}